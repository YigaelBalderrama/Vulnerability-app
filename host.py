import random
from flask import Flask, jsonify
import paho.mqtt.subscribe as subscribe
from flask_cors import CORS

app = Flask(__name__)
CORS(app)

last_msg = '{"id":,"BPM":,"Name":""}'
broker = 'broker.hivemq.com'
port = 1883
topic = "seguridad/"
client_id = f'python-mqtt-{random.randint(0, 100)}'
username = 'yigael'
password = 'public'

@app.route('/refresh_bpm', methods=['GET'])
def get_message():
    msg = subscribe.simple("seguridad/", 0, 1, hostname=broker, port=port, client_id=client_id, keepalive=60)
    print("%s %s" % (msg.topic, msg.payload))
    return msg.payload


if __name__ == '__main__':
   app.run(debug=True, port=5500)

