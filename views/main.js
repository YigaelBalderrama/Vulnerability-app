var pacients = 
    [
        {"id" : 345456, "name" : "Marquito Marquez", "bpms" : 99.6}, 
        {"id" : 456543, "name" : "Taurino Del Prado", "bpms" : 99.6},
        {"id" : 456522, "name" : "Leucemio Acosta", "bpms" : 99.6},
        {"id" : 456543, "name" : "Yakelino Sindi", "bpms" : 89.5},
        {"id" : 456584, "name" : "Lorenzzo Metralli", "bpms" : 89.6}
    ];
var baseUrl = "http://127.0.0.1:5501/refresh_bpm";
    function loadTable(listPacients)
    {
        var number = 1,
        content = listPacients.map(p=>{ 
            let cadena = "<tr><th scope='row'>"+number+"</th><td>"+p.id+"</td><td>"+p.name+"</td><td>"+p.bpms+"</td></tr>";
            number = number + 1;
            return cadena;
        });
        document.getElementById('body-pacients').innerHTML = content.toString();
    }
function readBPMS(pacients){
    var dangers = pacients.filter(number => number.bpms >= 200);
        
    if (dangers.length > 0)
    {
        
        let names = "";
        dangers.forEach(element => {
            names= names + "_"+ element.name+"<br>";
        });
        console.log(dangers);
        console.log(names);
        document.getElementById('alert').innerHTML = "PACIENTES ESTAn ENTRANDO EN PARO:<br>"+names;
        document.getElementById('alert').classList.remove("alert-secondary");
        document.getElementById('alert').classList.add("alert-danger");
        document.getElementById('alert').style.color = "red";
    }
    else
    {
        document.getElementById('alert').innerHTML = "TODOS LOS PACIENTES POSEEN BPM'S NORMAL";
        document.getElementById('alert').classList.remove("alert-danger");
        document.getElementById('alert').classList.add("alert-secondary");
        document.getElementById('alert').style.color = "black";
    }

}
async function refreshList(){
    request = await fetchPacients();
    console.log(request);
    pacients.push({"id" : request.response.id, "name" : request.response.name, "bpms" : request.response.bpms});
    readBPMS(pacients);
    loadTable(pacients);

}

 async function fetchPacients(){
    const url = baseUrl;
    let response = "";
    try{
        
            response = await fetch(url,{
            headers: { 
                "Content-Type": "application/json; charset=utf-8",
            },
            method: 'GET'
        });
        console.log(response);
    } catch(error){
        console.log(response);
        alert(`error ${error}.`);
    }
    try{
        if(response.status == 200){
            let data = await response.json();
            return data;
        } else {
            alert(`error ${response.status}.`);
        }
    } catch(error){
        alert(`error ${error}.`);
    }
    console.log("here");
    return response;
}
window.addEventListener("load",(event) =>{
    loadTable(pacients);
    readBPMS(pacients);
});
///class="alert alert-danger"
